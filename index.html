<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¦™éº—æ­²æ•¸è¨ˆç®—æ©Ÿ</title>
  <!-- å¤–éƒ¨æ¨£å¼ -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="bg">
    <img
      src="https://images.unsplash.com/photo-1762751436615-e65c7c392f93?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
      alt="Corgi background"
    />
  </div>
  <div class="app">
    <div class="card">
      <h1 class="title">ğŸ¶ å¦™éº—æ­²æ•¸è¨ˆç®—æ©Ÿ</h1>

      <div class="field-row">
        <label for="birthDate">ç‹—ç‹—çš„å‡ºç”Ÿæ—¥æœŸï¼š</label>
        <input type="date" id="birthDate" />
      </div>

      <button id="calcBtn">é–‹å§‹è¨ˆç®—</button>

      <p class="error" id="errorMsg"></p>

      <div class="result-box" id="result" aria-live="polite"></div>

      <p class="note">

      </p>
    </div>
  </div>

<script>
  const DOG_NAME = "å¦™éº—";
  const STORAGE_KEY = "dogAgeCalcBirth"; // åªå­˜ç”Ÿæ—¥

  // æŠŠæ—¥æœŸä¸Šé™é–åœ¨ä»Šå¤©
  (function setMaxDate() {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    const todayStr = `${yyyy}-${mm}-${dd}`;
    document.getElementById("birthDate").setAttribute("max", todayStr);
  })();

  // å…±ç”¨ï¼šçµ¦ä¸€å€‹ç”Ÿæ—¥å­—ä¸²ï¼Œå¹«ä½ ç®—å‡ºçµæœä¸¦é¡¯ç¤º
  function calculateAndShow(birthStr, options = { save: false }) {
    const birthInput = document.getElementById("birthDate");
    const resultEl = document.getElementById("result");
    const errorEl = document.getElementById("errorMsg");

    // å…ˆæŠŠç”Ÿæ—¥å¡«å› inputï¼ˆè¼‰å…¥æ™‚ä¹Ÿæœƒç”¨åˆ°ï¼‰
    birthInput.value = birthStr;

    const birthDate = new Date(birthStr);
    const today = new Date();

    // å¦‚æœç”Ÿæ—¥åœ¨æœªä¾†ï¼Œç•¶ä½œéŒ¯èª¤è™•ç†
    if (birthDate > today) {
      errorEl.textContent = "å‡ºç”Ÿæ—¥æœŸä¸èƒ½æ™šæ–¼ä»Šå¤©ã€‚";
      resultEl.textContent = "";
      resultEl.style.display = "none";
      return;
    }

    errorEl.textContent = "";

    // è¨ˆç®—ç‹—ç‹—å¯¦éš›å¹´é½¡ï¼ˆå¹´ï¼‰
    const diffMs = today - birthDate;
    const diffYears = diffMs / (1000 * 60 * 60 * 24 * 365.25);
    const dogYears = Math.round(diffYears * 10) / 10;

    // ç°¡åŒ–è¨ˆç®—ï¼šäººé¡å¹´é½¡ = ç‹—ç‹—å¹´é½¡ Ã— 7
    const humanYears = Math.round(dogYears * 7 * 10) / 10;

    // å¡é€²çµæœå€
    resultEl.innerHTML =
      DOG_NAME +
      "ç¾åœ¨å¤§ç´„ <strong>" +
      dogYears.toFixed(1) +
      "</strong> æ­²ç‹—ç‹—å¹´é½¡ï¼Œæ›ç®—æˆäººé¡å¹´é½¡å¤§ç´„æ˜¯ <strong>" +
      humanYears.toFixed(1) +
      "</strong> æ­²ã€‚";

    resultEl.style.display = "block";

    // éœ€è¦çš„æ™‚å€™æ‰å­˜é€² localStorageï¼ˆé€šå¸¸æ˜¯æŒ‰ä¸‹æŒ‰éˆ•é‚£æ¬¡ï¼‰
    if (options.save) {
      localStorage.setItem(STORAGE_KEY, birthStr);
    }
  }

  // è¼‰å…¥é é¢æ™‚ï¼Œçœ‹çœ‹ localStorage æœ‰æ²’æœ‰ä¹‹å‰å­˜çš„ç”Ÿæ—¥ï¼Œæœ‰çš„è©±å°±ç”¨ä»Šå¤©æ—¥æœŸé‡ç®—
  (function loadFromStorage() {
    const storedBirth = localStorage.getItem(STORAGE_KEY);
    if (!storedBirth) return;
    calculateAndShow(storedBirth); // é€™è£¡ä¸éœ€è¦å†å­˜ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸å¸¶ save:true
  })();

  document.getElementById("calcBtn").addEventListener("click", function () {
    const birthStr = document.getElementById("birthDate").value;
    const resultEl = document.getElementById("result");
    const errorEl = document.getElementById("errorMsg");

    // æ²’é¸æ—¥æœŸ â†’ é¡¯ç¤ºéŒ¯èª¤ã€éš±è—çµæœï¼Œä¸å­˜ä»»ä½•æ±è¥¿
    if (!birthStr) {
      errorEl.textContent = "è«‹å…ˆé¸æ“‡ç‹—ç‹—çš„å‡ºç”Ÿæ—¥æœŸã€‚";
      resultEl.textContent = "";
      resultEl.style.display = "none";
      return;
    }

    // æŒ‰æŒ‰éˆ•é€™æ¬¡ï¼šè¨ˆç®—ï¼‹é¡¯ç¤ºï¼‹å­˜åˆ° localStorage
    calculateAndShow(birthStr, { save: true });
  });
</script>
</body>
</html>
